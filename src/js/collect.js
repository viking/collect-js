/*
Evento version 1.1.0
Copyright (c) 2013, Peter Michaux
All rights reserved.
Licensed under the Simplified BSD License.
https://github.com/petermichaux/evento/blob/master/LICENSE
*/

/*
Hijos version 1.1.0
Copyright (c) 2013, Peter Michaux
All rights reserved.
Licensed under the Simplified BSD License.
https://github.com/petermichaux/hijos/blob/master/LICENSE
*/

/*
Arbutus version 4
Copyright (c) 2013, Peter Michaux
All rights reserved.
Licensed under the Simplified BSD License.
https://github.com/petermichaux/arbutus/blob/master/LICENSE
*/

/*
Grail version 4
Copyright (c) 2012, Peter Michaux
All rights reserved.
Licensed under the Simplified BSD License.
https://github.com/petermichaux/grail/blob/master/LICENSE
*/

/*
Hormigas version 1.1.0
Copyright (c) 2013, Peter Michaux
All rights reserved.
Licensed under the Simplified BSD License.
https://github.com/petermichaux/hormigas/blob/master/LICENSE
*/

/**
@license
Maria 1.1.0
Copyright (c) 2013, Peter Michaux
All rights reserved.
Licensed under the Simplified BSD License.
http://peter.michaux.ca/downloads/maria/1.1.0/LICENSE
*/

define("lib/maria",[],function(){var e={};e.EventTarget=function(){},e.EventTarget.superConstructor=Object,function(){function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var n=function(){function e(){}return function(t){return e.prototype=t,t=new e,e.prototype=null,t}}();e.EventTarget.prototype.addEventListener=function(e,n){t(this,"_evento_listeners")||(this._evento_listeners={}),t(this._evento_listeners,e)||(this._evento_listeners[e]=[]);var r=this._evento_listeners[e];for(var i=0,s=r.length;i<s;i++)if(r[i]===n)return;r.push(n)},e.EventTarget.prototype.removeEventListener=function(e,n){if(t(this,"_evento_listeners")&&t(this._evento_listeners,e)){var r=this._evento_listeners[e];for(var i=0,s=r.length;i<s;i++)if(r[i]===n){r.splice(i,1);return}}},e.EventTarget.prototype.addParentEventTarget=function(e){if(typeof e.dispatchEvent!="function")throw new TypeError("evento.EventTarget.prototype.addParentEventTarget: Parents must have dispatchEvent method.");t(this,"_evento_parents")||(this._evento_parents=[]);var n=this._evento_parents;for(var r=0,i=n.length;r<i;r++)if(n[r]===e)return;n.push(e)},e.EventTarget.prototype.removeParentEventTarget=function(e){if(t(this,"_evento_parents")){var n=this._evento_parents;for(var r=0,i=n.length;r<i;r++)if(n[r]===e){n.splice(r,1);return}}},e.EventTarget.prototype.dispatchEvent=function(e){e=n(e),"target"in e||(e.target=this),e.currentTarget=this,e._propagationStopped="bubbles"in e?!e.bubbles:!1,e.stopPropagation=function(){e._propagationStopped=!0};if(t(this,"_evento_listeners")&&t(this._evento_listeners,e.type)){var r=this._evento_listeners[e.type].slice(0);for(var i=0,s=r.length;i<s;i++){var o=r[i];typeof o=="function"?o.call(this,e):o.handleEvent(e)}}if(t(this,"_evento_parents")&&!e._propagationStopped){var u=this._evento_parents.slice(0);for(var i=0,s=u.length;i<s;i++)u[i].dispatchEvent(e)}},e.EventTarget.call(e.EventTarget.prototype),e.EventTarget.mixin=function(n){var r=e.EventTarget.prototype;for(var i in r)t(r,i)&&typeof r[i]=="function"&&(n[i]=r[i]);e.EventTarget.call(n)}}(),function(){function t(e,t,n,r){var i={element:e,type:t,listener:n};arguments.length>3&&(i.auxArg=r);if(typeof n=="function"){var s=arguments.length>3?r:e;i.wrappedHandler=function(e){n.call(s,e)}}else if(typeof r=="function")i.wrappedHandler=function(e){r.call(n,e)};else{var o=arguments.length>3?r:"handleEvent";i.wrappedHandler=function(e){n[o](e)}}return i}function n(e,t){return e.element===t.element&&e.type===t.type&&e.listener===t.listener&&(!e.hasOwnProperty("auxArg")&&!t.hasOwnProperty("auxArg")||e.hasOwnProperty("auxArg")&&t.hasOwnProperty("auxArg")&&e.auxArg===t.auxArg)}function r(e,t){for(var r=0,i=e.length;r<i;r++)if(n(e[r],t))return r;return-1}e.on=function(e,n,i,s){var o=t.apply(null,arguments);if(i._evento_bundles){if(r(i._evento_bundles,o)>=0)return}else i._evento_bundles=[];if(typeof o.element.addEventListener=="function")o.element.addEventListener(o.type,o.wrappedHandler,!1);else{if(typeof o.element.attachEvent!="object"||o.element.attachEvent===null)throw new Error("evento.on: Supported EventTarget interface not found.");o.element.attachEvent("on"+o.type,o.wrappedHandler)}i._evento_bundles.push(o)};var i=e.off=function(e,n,i,s){if(i._evento_bundles){var o=r(i._evento_bundles,t.apply(null,arguments));if(o>=0){var u=i._evento_bundles[o];if(typeof u.element.removeEventListener=="function")u.element.removeEventListener(u.type,u.wrappedHandler,!1);else{if(typeof u.element.detachEvent!="object"||u.element.detachEvent===null)throw new Error("evento.off: Supported EventTarget interface not found.");u.element.detachEvent("on"+u.type,u.wrappedHandler)}i._evento_bundles.splice(o,1)}}};e.purge=function(e){if(e._evento_bundles){var t=e._evento_bundles.slice(0);for(var n=0,r=t.length;n<r;n++){var s=t[n];s.hasOwnProperty("auxArg")?i(s.element,s.type,s.listener,s.auxArg):i(s.element,s.type,s.listener)}}}}();var t={};t.Leaf=function(){this.parentNode=null,this.previousSibling=null,this.nextSibling=null},t.Leaf.superConstructor=Object,t.Leaf.prototype.destroy=function(){this.parentNode=null,this.previousSibling=null,this.nextSibling=null},t.Leaf.call(t.Leaf.prototype),t.Leaf.mixin=function(e){e.destroy=t.Leaf.prototype.destroy,t.Leaf.call(e)},t.Node=function(){t.Leaf.call(this),this.childNodes=[],this.firstChild=null,this.lastChild=null},t.Node.superConstructor=t.Leaf,t.Node.prototype=function(){function e(){}return e.prototype=t.Leaf.prototype,new e}(),t.Node.prototype.constructor=t.Node,t.Node.prototype.destroy=function(){var e=this.childNodes.slice(0);for(var n=0,r=e.length;n<r;n++)e[n].destroy();t.Leaf.prototype.destroy.call(this),this.childNodes=null,this.firstChild=null,this.lastChild=null},t.Node.prototype.hasChildNodes=function(){return this.childNodes.length>0},t.Node.prototype.insertBefore=function(e,t){if(arguments.length<2)throw new Error("hijos.Node.prototype.insertBefore: not enough arguments.");t===undefined&&(t=null);if(e===t||t&&t.previousSibling===e||t===null&&this.lastChild===e)return;var n=this;while(n){if(n===e)throw new Error("hijos.Node.prototype.insertBefore: Node cannot be inserted at the specified point in the hierarchy.");n=n.parentNode}var r=e.parentNode;r&&r.removeChild(e);var i=this.childNodes,s;if(t===null)s=i.length;else{for(var o=0,u=i.length;o<u;o++)if(i[o]===t){s=o;break}if(typeof s!="number")throw new Error("hijos.Node.prototype.insertBefore: Node was not found.")}i.splice(s,0,e),this.firstChild=i[0],this.lastChild=i[i.length-1],e.parentNode=this;var a=e.previousSibling=i[s-1]||null;a&&(a.nextSibling=e);var f=e.nextSibling=i[s+1]||null;f&&(f.previousSibling=e)},t.Node.prototype.appendChild=function(e){if(arguments.length<1)throw new Error("hijos.Node.prototype.appendChild: not enough arguments.");this.insertBefore(e,null)},t.Node.prototype.replaceChild=function(e,t){if(arguments.length<2)throw new Error("hijos.Node.prototype.replaceChild: not enough arguments.");if(!t)throw new Error("hijos.Node.prototype.replaceChild: oldChild must not be falsy.");if(e===t)return;this.insertBefore(e,t),this.removeChild(t)},t.Node.prototype.removeChild=function(e){if(arguments.length<1)throw new Error("hijos.Node.prototype.removeChild: not enough arguments.");var t=this.childNodes;for(var n=0,r=t.length;n<r;n++)if(t[n]===e){var i=t[n-1];i&&(i.nextSibling=e.nextSibling);var s=t[n+1];s&&(s.previousSibling=e.previousSibling),e.parentNode=null,e.previousSibling=null,e.nextSibling=null,t.splice(n,1),this.firstChild=t[0]||null,this.lastChild=t[t.length-1]||null;return}throw new Error("hijos.Node.prototype.removeChild: node not found.")},t.Node.call(t.Node.prototype),t.Node.mixin=function(e){for(var n in t.Node.prototype)Object.prototype.hasOwnProperty.call(t.Node.prototype,n)&&typeof t.Node.prototype[n]=="function"&&(e[n]=t.Node.prototype[n]);t.Node.call(e)};var n={};(function(){function r(n){return n.replace(e,"").replace(t,"")}function i(e){return e.firstChild}function s(e){return e.firstChild.firstChild}function o(e){return e.firstChild.firstChild.nextSibling}function u(e){return e.firstChild.firstChild.firstChild}function a(e){return e.firstChild.firstChild.firstChild.firstChild}function f(e,t,n){return function(r,i){var s=i.createElement("div"),o=i.createDocumentFragment();s.innerHTML=e+r+t;var u=n(s),a;while(u)a=u.nextSibling,o.appendChild(u),u=a;return o}}var e=/^\s+/,t=/\s+$/,l=f("","",i),c={td:f("<table><tbody><tr>","</tr></tbody></table>",a),tr:f("<table><tbody>","</tbody></table>",u),tbody:f("<table>","</table>",s),col:f("<table><colgroup>","</colgroup></table>",u),option:f("<select><option>a</option>","</select>",o)};c.th=c.td,c.thead=c.tbody,c.tfoot=c.tbody,c.caption=c.tbody,c.colgroup=c.tbody;var h=/^<([a-z]+)/i;n.parseHTML=function(e,t){e=r(e);var n=l,i=e.match(h);if(i){var s=i[1].toLowerCase();Object.prototype.hasOwnProperty.call(c,s)&&(n=c[s])}return n(e,t||document)}})();var r={};(function(){function s(n){return n.replace(e,"").replace(t,"")}function o(e,t){return typeof e[t]=="function"||typeof e[t]=="object"&&e[t]!==null}function u(e,t){return t.id===e?t:o(t,"getElementById")?t.getElementById(e):o(t,"querySelector")?t.querySelector("#"+e):l(t,function(t){return t.id===e})}function a(e,t){e=e?e.toUpperCase():"*";if(t)var n=new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)");return function(r){return(e==="*"||r.tagName&&r.tagName.toUpperCase()===e)&&(!t||n.test(r.className))}}function f(e,t){function r(e){t(e)&&n.push(e),e=e.firstChild;while(e)r(e),e=e.nextSibling}var n=[];return r(e),n}function l(e,t){function n(e){if(t(e))return e;e=e.firstChild;while(e){var r=n(e);if(r)return r;e=e.nextSibling}}return n(e)}var e=/^\s+/,t=/\s+$/,n=/^#(\S+)$/,i=/^([\w-]+)?(?:\.([\w-]+))?$/;r.findAll=function(e,t){e=s(e),t=t||document;var r;if(r=e.match(n)){var l=u(r[1],t);return l?[l]:[]}if(r=e.match(i)){var c=a(r[1],r[2]);if(o(t,"querySelectorAll")){var h,p=[];c(t)&&p.push(t),h=t.querySelectorAll(e);for(var d=0,v=h.length;d<v;d++)p.push(h[d]);return p}return f(t,c)}throw new Error('grail.findAll: Unsupported selector "'+e+'".')},r.find=function(e,t){e=s(e),t=t||document;var r;if(r=e.match(n))return u(r[1],t);if(r=e.match(i)){var f=a(r[1],r[2]);return o(t,"querySelector")?f(t)?t:t.querySelector(e):l(t,f)}throw new Error('grail.find: Unsupported selector "'+e+'".')}})();var i={};(function(){function t(){return e++}function n(e){e._hormigas_ObjectSet_elements={},e.size=0}var e=0;i.ObjectSet=function(){n(this);for(var e=0,t=arguments.length;e<t;e++)this.add(arguments[e])},i.ObjectSet.superConstructor=Object,i.ObjectSet.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(e,"_hormigas_ObjectSet_id")&&Object.prototype.hasOwnProperty.call(this._hormigas_ObjectSet_elements,e._hormigas_ObjectSet_id)},i.ObjectSet.prototype.add=function(e){if(this.has(e))return!1;var n;return Object.prototype.hasOwnProperty.call(e,"_hormigas_ObjectSet_id")||(e._hormigas_ObjectSet_id=t()),this._hormigas_ObjectSet_elements[e._hormigas_ObjectSet_id]=e,this.size++,!0},i.ObjectSet.prototype["delete"]=function(e){return this.has(e)?(delete this._hormigas_ObjectSet_elements[e._hormigas_ObjectSet_id],this.size--,!0):!1},i.ObjectSet.prototype.clear=function(){return this.size>0?(n(this),!0):!1},i.ObjectSet.prototype.toArray=function(){var e=[];for(var t in this._hormigas_ObjectSet_elements)Object.prototype.hasOwnProperty.call(this._hormigas_ObjectSet_elements,t)&&e.push(this._hormigas_ObjectSet_elements[t]);return e},i.ObjectSet.prototype.forEach=function(e){var t=arguments[1];for(var n in this._hormigas_ObjectSet_elements)Object.prototype.hasOwnProperty.call(this._hormigas_ObjectSet_elements,n)&&e.call(t,this._hormigas_ObjectSet_elements[n])},i.ObjectSet.prototype.every=function(e){var t=arguments[1];for(var n in this._hormigas_ObjectSet_elements)if(Object.prototype.hasOwnProperty.call(this._hormigas_ObjectSet_elements,n)&&!e.call(t,this._hormigas_ObjectSet_elements[n]))return!1;return!0},i.ObjectSet.prototype.some=function(e){var t=arguments[1];for(var n in this._hormigas_ObjectSet_elements)if(Object.prototype.hasOwnProperty.call(this._hormigas_ObjectSet_elements,n)&&e.call(t,this._hormigas_ObjectSet_elements[n]))return!0;return!1},i.ObjectSet.prototype.reduce=function(e){var t=this.toArray(),n=0,r=t.length,i;if(arguments.length>1)i=arguments[1];else{if(r<1)throw new TypeError("reduce of empty set with no initial value");n=1,i=t[0]}while(n<r)i=e.call(undefined,i,t[n]),n++;return i}})(),i.ObjectSet.call(i.ObjectSet.prototype),i.ObjectSet.mixin=function(e){for(var t in i.ObjectSet.prototype)Object.prototype.hasOwnProperty.call(i.ObjectSet.prototype,t)&&typeof i.ObjectSet.prototype[t]=="function"&&(e[t]=i.ObjectSet.prototype[t]);i.ObjectSet.call(e)};var s={};return s.create=function(){function e(){}return function(t){return e.prototype=t,t=new e,e.prototype=null,t}}(),s.borrow=function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},s.subclass=function(e,t,n){n=n||{};var r=n.properties,i=this,o=e[t]=Object.prototype.hasOwnProperty.call(n,"constructor")?n.constructor:function(){i.apply(this,arguments)};o.superConstructor=i;var u=o.prototype=s.create(i.prototype);u.constructor=o,r&&s.borrow(u,r),o.subclass=function(){i.subclass.apply(this,arguments)}},s.on=e.on,s.off=e.off,s.purge=e.purge,s.Leaf=t.Leaf,s.Node=t.Node,s.Model=function(){e.EventTarget.call(this)},s.Model.superConstructor=e.EventTarget,s.Model.prototype=s.create(e.EventTarget.prototype),s.Model.prototype.constructor=s.Model,s.Model.prototype.destroy=function(){this.dispatchEvent({type:"destroy"})},s.SetModel=function(){i.ObjectSet.apply(this,arguments),s.Model.call(this)},s.SetModel.superConstructor=s.Model,s.SetModel.prototype=s.create(s.Model.prototype),s.SetModel.prototype.constructor=s.SetModel,i.ObjectSet.mixin(s.SetModel.prototype),s.SetModel.prototype.add=function(){var e=[];for(var t=0,n=arguments.length;t<n;t++){var r=arguments[t];i.ObjectSet.prototype.add.call(this,r)&&(e.push(r),typeof r.addEventListener=="function"&&typeof r.removeEventListener=="function"&&r.addEventListener("destroy",this),typeof r.addParentEventTarget=="function"&&typeof r.removeParentEventTarget=="function"&&r.addParentEventTarget(this))}var s=e.length>0;return s&&this.dispatchEvent({type:"change",addedTargets:e,deletedTargets:[]}),s},s.SetModel.prototype["delete"]=function(){var e=[];for(var t=0,n=arguments.length;t<n;t++){var r=arguments[t];i.ObjectSet.prototype["delete"].call(this,r)&&(e.push(r),typeof r.removeEventListener=="function"&&r.removeEventListener("destroy",this),typeof r.removeParentEventTarget=="function"&&r.removeParentEventTarget(this))}var s=e.length>0;return s&&this.dispatchEvent({type:"change",addedTargets:[],deletedTargets:e}),s},s.SetModel.prototype.clear=function(){var e=this.toArray(),t=i.ObjectSet.prototype.clear.call(this);if(t){for(var n=0,r=e.length;n<r;n++){var s=e[n];typeof s.removeEventListener=="function"&&s.removeEventListener("destroy",this),typeof s.removeParentEventTarget=="function"&&s.removeParentEventTarget(this)}this.dispatchEvent({type:"change",addedTargets:[],deletedTargets:e})}return t},s.SetModel.prototype.handleEvent=function(e){e.type==="destroy"&&e.currentTarget===e.target&&this["delete"](e.target)},s.View=function(e,t){s.Node.call(this),this.setModel(e),this.setController(t)},s.View.superConstructor=s.Node,s.View.prototype=s.create(s.Node.prototype),s.View.prototype.constructor=s.View,s.View.prototype.destroy=function(){s.purge(this),this._model=null,this._controller&&(this._controller.destroy(),this._controller=null),s.Node.prototype.destroy.call(this)},s.View.prototype.update=function(){},s.View.prototype.getModel=function(){return this._model},s.View.prototype.setModel=function(e){this._setModelAndController(e,this._controller)},s.View.prototype.getDefaultControllerConstructor=function(){return s.Controller},s.View.prototype.getDefaultController=function(){var e=this.getDefaultControllerConstructor();return new e},s.View.prototype.getController=function(){return this._controller||this.setController(this.getDefaultController()),this._controller},s.View.prototype.setController=function(e){this._setModelAndController(this._model,e)},s.View.prototype.getModelActions=function(){return{change:"update"}},s.View.prototype._setModelAndController=function(e,t){var n,r;if(this._model!==e){if(this._model){r=this._lastModelActions;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&s.off(this._model,n,this,r[n]);delete this._lastModelActions}if(e){r=this._lastModelActions=this.getModelActions()||{};for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&s.on(e,n,this,r[n])}this._model=e}this._controller!==t&&this._controller&&(this._controller.setView(null),this._controller.setModel(null)),t&&(t.setView(this),t.setModel(e)),this._controller=t},s.ElementView=function(e,t,n){s.View.call(this,e,t),this.setDocument(n)},s.ElementView.superConstructor=s.View,s.ElementView.prototype=s.create(s.View.prototype),s.ElementView.prototype.constructor=s.ElementView,s.ElementView.prototype.getDocument=function(){return this._doc||document},s.ElementView.prototype.setDocument=function(e){this._doc=e;var t=this.childNodes;for(var n=0,r=t.length;n<r;n++)t[n].setDocument(e)},s.ElementView.prototype.getTemplate=function(){return"<div></div>"},s.ElementView.prototype.getUIActions=function(){return{}},s.ElementView.prototype.build=function(){return this._rootEl||(this.buildTemplate(),this.buildUIActions(),this.buildData(),this.buildChildViews()),this._rootEl},s.ElementView.prototype.buildTemplate=function(){var e=n.parseHTML(this.getTemplate(),this.getDocument());this._rootEl=e.firstChild},function(){var e=/^(\S+)\s*(.*)$/;s.ElementView.prototype.buildUIActions=function(){var t=this.getUIActions();for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=n.match(e),i=r[1],o=r[2],u=t[n],a=this.findAll(o,this._rootEl);for(var f=0,l=a.length;f<l;f++)s.on(a[f],i,this,u)}}}(),s.ElementView.prototype.buildData=function(){},s.ElementView.prototype.buildChildViews=function(){var e=this.childNodes;for(var t=0,n=e.length;t<n;t++)this.getContainerEl().appendChild(e[t].build())},s.ElementView.prototype.getContainerEl=function(){return this.build()},s.ElementView.prototype.insertBefore=function(e,t){s.View.prototype.insertBefore.call(this,e,t),this._rootEl&&this.getContainerEl().insertBefore(e.build(),t?t.build():null)},s.ElementView.prototype.removeChild=function(e){s.View.prototype.removeChild.call(this,e),this._rootEl&&this.getContainerEl().removeChild(e.build())},s.ElementView.prototype.find=function(e){return r.find(e,this.build())},s.ElementView.prototype.findAll=function(e){return r.findAll(e,this.build())},s.SetView=function(){s.ElementView.apply(this,arguments)},s.SetView.superConstructor=s.ElementView,s.SetView.prototype=s.create(s.ElementView.prototype),s.SetView.prototype.constructor=s.SetView,s.SetView.prototype.buildChildViews=function(){var e=this.getModel().toArray();for(var t=0,n=e.length;t<n;t++)this.appendChild(this.createChildView(e[t]))},s.SetView.prototype.createChildView=function(e){return new s.ElementView(e)},s.SetView.prototype.update=function(e){e.target===this.getModel()&&(e.addedTargets&&e.addedTargets.length&&this.handleAdd(e),e.deletedTargets&&e.deletedTargets.length&&this.handleDelete(e))},s.SetView.prototype.handleAdd=function(e){var t=e.addedTargets;for(var n=0,r=t.length;n<r;n++)this.appendChild(this.createChildView(t[n]))},s.SetView.prototype.handleDelete=function(e){var t=e.deletedTargets;for(var n=0,r=t.length;n<r;n++){var i=t[n],s=this.childNodes;for(var o=0,u=s.length;o<u;o++){var a=s[o];if(a.getModel()===i){this.removeChild(a),a.destroy();break}}}},s.Controller=function(){},s.Controller.superConstructor=Object,s.Controller.prototype.destroy=function(){this._model=null,this._view&&(this._view.setController(null),this._view=null)},s.Controller.prototype.getModel=function(){return this._model},s.Controller.prototype.setModel=function(e){this._model=e},s.Controller.prototype.getView=function(){return this._view},s.Controller.prototype.setView=function(e){this._view=e},s.Model.subclass=function(){s.subclass.apply(this,arguments)},s.SetModel.subclass=function(){s.Model.subclass.apply(this,arguments)},s.View.subclass=function(e,t,n){n=n||{};var r=n.controllerConstructor,i=n.controllerConstructorName||t.replace(/(View|)$/,"Controller"),o=n.modelActions,u=n.properties||(n.properties={});Object.prototype.hasOwnProperty.call(u,"getDefaultControllerConstructor")||(u.getDefaultControllerConstructor=function(){return r||e[i]}),o&&!Object.prototype.hasOwnProperty.call(u,"getModelActions")&&(u.getModelActions=function(){return o}),s.subclass.call(this,e,t,n)},s.ElementView.subclass=function(e,t,n){n=n||{};var r=n.template,i=n.templateName||t.replace(/(View|)$/,"Template"),o=n.uiActions,u=n.properties||(n.properties={});Object.prototype.hasOwnProperty.call(u,"getTemplate")||(r?u.getTemplate=function(){return r}:i&&(u.getTemplate=function(){return e[i]}));if(o){Object.prototype.hasOwnProperty.call(u,"getUIActions")||(u.getUIActions=function(){return o});for(var a in o)if(Object.prototype.hasOwnProperty.call(o,a)){var f=o[a];!Object.prototype.hasOwnProperty.call(u,f)&&!(f in this.prototype)&&function(e){u[e]=function(t){this.getController()[e](t)}}(f)}}s.View.subclass.call(this,e,t,n)},s.SetView.subclass=function(){s.ElementView.subclass.apply(this,arguments)},s.Controller.subclass=function(){s.subclass.apply(this,arguments)},s}),define("util",[],function(){var e={};return e.capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.camelize=function(t){var n="";return t.split("_").forEach(function(t){n+=e.capitalize(t)}),n},e.instantiateModel=function(t,n){var r=new t;for(key in n){var i="set"+e.camelize(key);r[i].call(r,n[key])}return r},e}),define("persistence/local",["lib/maria","util"],function(e,t){var n=function(e,t,n,r){this._store=e,this._collectionName=t,this._setModel=n,this._options=r};n.prototype.getSetModel=function(){return this._setModel},n.prototype.handleEvent=function(e){if(e.type!="change")return;e.addedTargets&&e.addedTargets.map(function(e){this._store.create(this._collectionName,e,this._options)},this)};var r=function(){this._setModelProxies={}};return r.prototype.getCollection=function(e,t){var n=this;setTimeout(function(){t(n._getCollection(e))},0)},r.prototype.create=function(e,t,n){var r=this;setTimeout(function(){r._create.call(r,e,t,n)},0)},r.prototype.update=function(e,t,n){var r=this;setTimeout(function(){r._update.call(r,e,t,n)},0)},r.prototype.addSetModel=function(t,r,i){var s=new n(this,t,r,i);e.on(r,"change",s);var o=this._setModelProxies[t];o||(o=this._setModelProxies[t]=[]),o.push(s)},r.prototype.removeSetModel=function(t,n){var r=this._setModelProxies[t];r&&r.map(function(t){var r=t.getSetModel();r===n&&e.off(n,"change",t)})},r.prototype.findAll=function(e,t,n,r){var i=this;setTimeout(function(){i._findAll.call(i,e,t,n,r)},0)},r.prototype.find=function(e,t,n,r){var i=this;setTimeout(function(){i._find.call(i,e,t,n,r)},0)},r.prototype._create=function(e,t,n){var r=t.getAttributes();if(r.id&&n&&n.failure){n.failure("record id is non-null");return}var i=this._getCollection(e),s=i.length+1,o={},u;for(u in r)o[u]=r[u];o.id=s,i.push(o),this._setCollection(e,i),t.setId(s),n&&n.success&&n.success(s)},r.prototype._update=function(e,t,n){var r=this._getCollection(e),i=t.getAttributes(),s;for(var o=0;o<r.length;o++)if(r[o].id==i.id){s=r[o];break}if(!s&&n&&n.failure){n.failure("record not found");return}var u;for(u in i)s[u]=i[u];this._setCollection(e,r),n&&n.success&&n.success()},r.prototype._getCollection=function(e){var t;return typeof localStorage[e]=="undefined"?t=[]:t=JSON.parse(localStorage[e]),t},r.prototype._setCollection=function(e,t){localStorage[e]=JSON.stringify(t)},r.prototype._findAll=function(e,n,r,i){var s=this._getCollection(e),o=[];for(var u=0;u<s.length;u++){var a=!0,f=s[u];if(i.filter)for(fkey in i.filter)if(f[fkey]!=i.filter[fkey]){a=!1;break}if(a){var l=t.instantiateModel(r,f);o.push(l)}}n.add.apply(n,o),i.success&&i.success()},r.prototype._find=function(e,n,r,i){var s=this._getCollection(e);for(var o=0;o<s.length;o++){var u=s[o];if(u.id==n){var a=t.instantiateModel(r,u);i.success&&i.success(a);break}}},r}),define("controllers/app",["lib/maria"],function(e){var t={};return e.Controller.subclass(t,"AppController",{properties:{_window:window,_currentUrl:null,_rootUrl:null,_rootUrlPattern:null,_rootRoute:"_projects",_useAnchors:!1,_routes:[["_adminProjects",new RegExp("^/admin/projects$")],["_adminProject",new RegExp("^/admin/projects/(\\d+)$")],["_adminForm",new RegExp("^/admin/forms/(\\d+)$")]],setWindow:function(e){this._window=e},getWindow:function(){return this._window},setRootUrl:function(e){e.match(/\.html$/)?(this._rootUrl=e,this._useAnchors=!0,this._rootUrlPattern=new RegExp("^"+this._rootUrl+"#?")):(this._rootUrl=e.replace(/\/$/,""),this._rootUrlPattern=new RegExp("^"+this._rootUrl))},route:function(){var e=this._window.location.href;return e!=this._currentUrl&&this._urlIsValid(e)?(this._route(e),!0):!1},go:function(e){return e.match(/^\w+:|^\//)||(e=this.urlFor(e)),this._urlIsValid(e)?(this._window.history.pushState({},"",e),this._route(e),!0):!1},urlFor:function(e){return e=e.replace(/^\//,""),this._useAnchors?e==""?this._rootUrl:this._rootUrl+"#/"+e:this._rootUrl+"/"+e},onNavigate:function(e){if(e.target.tagName=="A"){var t=e.target.getAttribute("href");this.go(t),e.preventDefault()}},_urlIsValid:function(e){return e.match(this._rootUrlPattern)},_route:function(e){var t,n,r=e.replace(this._rootUrlPattern,"");if(this._useAnchors&&r==""||!this._useAnchors&&r=="/")t=this._rootRoute,n=[];else for(var i=0;i<this._routes.length;i++){var s=r.match(this._routes[i][1]);if(s){t=this._routes[i][0],n=s.slice(1);break}}if(!t)throw'the url "'+e+"\" didn't match any routes";this[t].apply(this,n),this._currentUrl=e},_projects:function(){this.getView().showProjects()},_adminProjects:function(){this.getView().showAdminProjects()},_adminProject:function(e){this.getView().showAdminProject(e)},_adminForm:function(e){this.getView().showAdminForm(e)}}}),t.AppController}),define("models/projects",["lib/maria"],function(e){var t={};return e.SetModel.subclass(t,"ProjectsModel",{}),t.ProjectsModel}),define("model",["lib/maria","util"],function(e,t){var n={};return e.Model.subclass(n,"Model",{constructor:function(){e.Model.apply(this,arguments),this._attributes={};if(this._attributeNames)for(var t=0;t<this._attributeNames.length;t++)this._attributes[this._attributeNames[t]]=null},properties:{_attributeNames:null,setAttribute:function(e,t,n){if(this._attributeNames&&this._attributeNames.indexOf(e)<0)throw"invalid attribute: "+e;return this._attributes[e]!=t?(this._attributes[e]=t,n||this.dispatchEvent({type:"change"}),!0):!1},setAttributes:function(e){var t=!1;for(var n in e)this.setAttribute(n,e[n],!0)&&(t=!0);t&&this.dispatchEvent({type:"change"})},getAttribute:function(e){if(this._attributeNames&&this._attributeNames.indexOf(e)<0)throw"invalid attribute: "+e;return this._attributes[e]},getAttributes:function(){return this._attributes}}}),n.Model.subclass=function(n,r,i){i=i||{};var s=i.properties||(i.properties={});if(i.associations)for(var o in i.associations){var u="get"+t.capitalize(o),a="_"+o,f=i.associations[o],l=f.setModel;(function(e,t){s[u]=function(){return this[e]||(this[e]=new t),this[e]}})(a,l)}if(i.attributeNames){for(var c=0;c<i.attributeNames.length;c++){var h=i.attributeNames[c],p=t.camelize(h),u="get"+p,d="set"+p;(function(e){s[u]=function(){return this.getAttribute(e)},s[d]=function(t){this.setAttribute(e,t)}})(h)}s._attributeNames=i.attributeNames}e.subclass.call(this,n,r,i);var v=n[r];i.associations&&(v.associations={},e.borrow(v.associations,i.associations)),i.entityName&&(v.entityName=i.entityName),i.collectionName&&(v.collectionName=i.collectionName)},n.Model}),define("models/forms",["lib/maria"],function(e){var t={};return e.SetModel.subclass(t,"FormsModel",{}),t.FormsModel}),define("models/project",["model","models/forms"],function(e,t){var n={};return e.subclass(n,"ProjectModel",{attributeNames:["id","name"],associations:{forms:{type:"hasMany",setModel:t,key:"project_id"}}}),n.ProjectModel}),define("models/questions",["lib/maria"],function(e){var t={};return e.SetModel.subclass(t,"QuestionsModel",{}),t.QuestionsModel}),define("models/form",["model","models/questions"],function(e,t){var n={};return e.subclass(n,"FormModel",{attributeNames:["id","name","project_id"],associations:{questions:{type:"hasMany",setModel:t,key:"form_id"}}}),n.FormModel}),define("models/question",["model"],function(e){var t={};return e.subclass(t,"QuestionModel",{attributeNames:["id","name","type","prompt","form_id"]}),t.QuestionModel}),define("templates/projects",[],function(){var e={};return e.source='<section class="projects">\n  <h2>Projects</h2>\n</section>\n',e}),define("templates/projects_list",[],function(){var e={};return e.source='<ul class="projects">\n</ul>\n',e}),define("templates/project_item",[],function(){var e={};return e.source='<li class="project"><span class="name"></span> [<a>admin</a>]</li>\n',e}),define("route_helper",[],function(){var e=function(){};return e.prototype.urlFor=function(e){return this.parentNode?this.parentNode.urlFor(e):e},e.mixin=function(t){t.urlFor=e.prototype.urlFor,e.call(t)},e}),define("views/project_item",["lib/maria","templates/project_item","route_helper"],function(e,t,n){var r={};return e.ElementView.subclass(r,"ProjectItemView",{controllerConstructor:null,template:t.source,constructor:function(){e.ElementView.apply(this,arguments),n.mixin(this)},properties:{buildData:function(){var e=this.getModel();this.find("span.name").innerHTML=e.getName(),this.find("a").setAttribute("href",this.urlFor("/admin/projects/"+e.getId()))},update:function(){this.buildData()}}}),r.ProjectItemView}),define("views/projects_list",["lib/maria","templates/projects_list","views/project_item","route_helper"],function(e,t,n,r){var i={};return e.SetView.subclass(i,"ProjectsListView",{controllerConstructor:null,template:t.source,constructor:function(){e.SetView.apply(this,arguments),r.mixin(this)},properties:{createChildView:function(e){return new n(e)}}}),i.ProjectsListView}),define("views/projects",["lib/maria","templates/projects","views/projects_list","route_helper"],function(e,t,n,r){var i={};return e.ElementView.subclass(i,"ProjectsView",{controllerConstructor:null,template:t.source,constructor:function(t){e.ElementView.apply(this,arguments),r.mixin(this),this.appendChild(new n(t))}}),i.ProjectsView}),define("templates/admin/projects",[],function(){var e={};return e.source='<section class="projects">\n  <h2>Projects</h2>\n</section>\n',e}),define("templates/admin/projects_list",[],function(){var e={};return e.source='<ul class="projects">\n</ul>\n',e}),define("templates/admin/project_item",[],function(){var e={};return e.source='<li class="project"><a></a></li>\n',e}),define("views/admin/project_item",["lib/maria","templates/admin/project_item","route_helper"],function(e,t,n){var r={};return e.ElementView.subclass(r,"AdminProjectItemView",{controllerConstructor:null,template:t.source,constructor:function(){e.ElementView.apply(this,arguments),n.mixin(this)},properties:{buildData:function(){var e=this.getModel(),t=this.find("a");t.innerHTML=e.getName(),t.setAttribute("href",this.urlFor("/admin/projects/"+e.getId()))},update:function(){this.buildData()}}}),r.AdminProjectItemView}),define("views/admin/projects_list",["lib/maria","templates/admin/projects_list","views/admin/project_item","route_helper"],function(e,t,n,r){var i={};return e.SetView.subclass(i,"AdminProjectsListView",{controllerConstructor:null,template:t.source,constructor:function(){e.SetView.apply(this,arguments),r.mixin(this)},properties:{createChildView:function(e){return new n(e)}}}),i.AdminProjectsListView}),define("controllers/admin/projects_form",["lib/maria","models/project"],function(e,t){var n={};return e.Controller.subclass(n,"AdminProjectsFormController",{properties:{onSubmit:function(){var e=this.getView(),n=e.getValues(),r=new t;r.setName(n.name),this.getModel().add(r),e.reset()}}}),n.AdminProjectsFormController}),define("templates/admin/projects_form",[],function(){var e={};return e.source='<section class="projects-form">\n  <h3>New project</h3>\n  <label>Name: <input class="name" type="text" name="name" /></label>\n  <input class="create" type="button" value="Create"/>\n</section>\n',e}),define("views/admin/projects_form",["lib/maria","controllers/admin/projects_form","templates/admin/projects_form","route_helper"],function(e,t,n,r){var i={};return e.ElementView.subclass(i,"AdminProjectsFormView",{controllerConstructor:t,template:n.source,constructor:function(){e.ElementView.apply(this,arguments),r.mixin(this)},uiActions:{"click input.create":"onSubmit"},properties:{reset:function(){this.find("input").value=""},getValues:function(){return{name:this.find("input").value}}}}),i.AdminProjectsFormView}),define("views/admin/projects",["lib/maria","templates/admin/projects","views/admin/projects_list","views/admin/projects_form","route_helper"],function(e,t,n,r,i){var s={};return e.ElementView.subclass(s,"AdminProjectsView",{controllerConstructor:null,template:t.source,constructor:function(t){e.ElementView.apply(this,arguments),i.mixin(this),this.appendChild(new n(t)),this.appendChild(new r(t))}}),s.AdminProjectsView}),define("templates/admin/project",[],function(){var e={};return e.source='<section class="project">\n  <header>\n    <h2>Project: <span class="name"></span></h2>\n  </header>\n</section>\n',e}),define("views/admin/project",["lib/maria","templates/admin/project","route_helper"],function(e,t,n){var r={};return e.ElementView.subclass(r,"AdminProjectView",{controllerConstructor:null,template:t.source,constructor:function(){e.ElementView.apply(this,arguments),n.mixin(this)},properties:{buildData:function(){var e=this.getModel();this.find("span.name").innerHTML=e.getName()},update:function(){this.buildData()}}}),r.AdminProjectView}),define("templates/admin/forms",[],function(){var e={};return e.source='<section class="forms">\n  <header>\n    <h2>Forms</h2>\n  </header>\n</section>\n',e}),define("templates/admin/forms_list",[],function(){var e={};return e.source='<ul class="forms">\n</ul>\n',e}),define("templates/admin/form_item",[],function(){var e={};return e.source='<li class="form"><a></a></li>\n',e}),define("views/admin/form_item",["lib/maria","templates/admin/form_item","route_helper"],function(e,t,n){var r={};return e.ElementView.subclass(r,"AdminFormItemView",{controllerConstructor:null,template:t.source,constructor:function(){e.ElementView.apply(this,arguments),n.mixin(this)},properties:{buildData:function(){var e=this.getModel(),t=this.find("a");t.innerHTML=e.getName(),t.setAttribute("href",this.urlFor("/admin/forms/"+e.getId()))},update:function(){this.buildData()}}}),r.AdminFormItemView}),define("views/admin/forms_list",["lib/maria","templates/admin/forms_list","views/admin/form_item","route_helper"],function(e,t,n,r){var i={};return e.SetView.subclass(i,"AdminFormsListView",{controllerConstructor:null,template:t.source,constructor:function(){e.SetView.apply(this,arguments),r.mixin(this)},properties:{createChildView:function(e){return new n(e)}}}),i.AdminFormsListView}),define("controllers/admin/forms_form",["lib/maria","models/form"],function(e,t){var n={};return e.Controller.subclass(n,"AdminFormsFormController",{properties:{onSubmit:function(){var e=this.getView(),n=e.getValues(),r=new t;r.setName(n.name),r.setProjectId(n.project_id),this.getModel().add(r),e.reset()}}}),n.AdminFormsFormController}),define("templates/admin/forms_form",[],function(){var e={};return e.source='<section class="forms-form">\n  <header>\n    <h3>New form</h3>\n  </header>\n  <label>Name: <input class="name" type="text" name="name" /></label>\n  <input class="create" type="button" value="Create"/>\n</section>\n',e}),define("views/admin/forms_form",["lib/maria","controllers/admin/forms_form","templates/admin/forms_form","route_helper"],function(e,t,n,r){var i={};return e.ElementView.subclass(i,"AdminFormsFormView",{controllerConstructor:t,template:n.source,constructor:function(){e.ElementView.apply(this,arguments),r.mixin(this)},uiActions:{"click input.create":"onSubmit"},properties:{_projectId:null,setProjectId:function(e){this._projectId=e},reset:function(){this.find("input").value=""},getValues:function(){return{name:this.find("input").value,project_id:this._projectId}}}}),i.AdminFormsFormView}),define("views/admin/forms",["lib/maria","templates/admin/forms","views/admin/forms_list","views/admin/forms_form","route_helper"],function(e,t,n,r,i){var s={};return e.ElementView.subclass(s,"AdminFormsView",{controllerConstructor:null,template:t.source,constructor:function(t){e.ElementView.apply(this,arguments),i.mixin(this),this._listView=new n(t),this.appendChild(this._listView),this._formView=new r(t),this.appendChild(this._formView)},properties:{_listView:null,_formView:null,setProjectId:function(e){this._formView.setProjectId(e)}}}),s.AdminFormsView}),define("templates/admin/form",[],function(){var e={};return e.source='<section class="form">\n  <header>\n    <h2>Form: <span class="name"></span></h2>\n  </header>\n</section>\n',e}),define("views/admin/form",["lib/maria","templates/admin/form","route_helper"],function(e,t,n){var r={};return e.ElementView.subclass(r,"AdminFormView",{controllerConstructor:null,template:t.source,constructor:function(){e.ElementView.apply(this,arguments),n.mixin(this)},properties:{buildData:function(){var e=this.getModel();this.find("span.name").innerHTML=e.getName()},update:function(){this.buildData()}}}),r.AdminFormView}),define("templates/admin/questions",[],function(){var e={};return e.source='<section class="questions">\n  <header>\n    <h2>Questions</h2>\n  </header>\n</section>\n',e}),define("templates/admin/questions_list",[],function(){var e={};return e.source='<ul class="questions">\n</ul>\n',e}),define("templates/admin/question_item",[],function(){var e={};return e.source='<li class="question"></li>\n',e}),define("views/admin/question_item",["lib/maria","templates/admin/question_item","route_helper"],function(e,t,n){var r={};return e.ElementView.subclass(r,"AdminQuestionItemView",{controllerConstructor:null,template:t.source,constructor:function(){e.ElementView.apply(this,arguments),n.mixin(this)},properties:{buildData:function(){var e=this.getModel(),t=this.find("li");t.innerHTML=e.getName()},update:function(){this.buildData()}}}),r.AdminQuestionItemView}),define("views/admin/questions_list",["lib/maria","templates/admin/questions_list","views/admin/question_item","route_helper"],function(e,t,n,r){var i={};return e.SetView.subclass(i,"AdminQuestionsListView",{template:t.source,constructor:function(){e.SetView.apply(this,arguments),r.mixin(this)},properties:{createChildView:function(e){return new n(e)}}}),i.AdminQuestionsListView}),define("controllers/admin/questions_form",["lib/maria","models/question"],function(e,t){var n={};return e.Controller.subclass(n,"AdminQuestionsFormController",{properties:{onSubmit:function(){var e=this.getView(),n=e.getValues(),r=new t;r.setName(n.name),r.setType(n.type),r.setPrompt(n.prompt),r.setFormId(n.form_id),this.getModel().add(r),e.reset()}}}),n.AdminQuestionsFormController}),define("templates/admin/questions_form",[],function(){var e={};return e.source='<section class="questions-form">\n  <header>\n    <h3>New question</h3>\n  </header>\n  <label>Name: <input class="name" type="text" name="name" /></label>\n  <label>\n    Type:\n    <select class="type" name="type">\n      <option>text</option>\n    </select>\n  </label>\n  <label>Prompt: <input class="prompt" type="text" name="prompt" /></label>\n  <input class="create" type="button" value="Create"/>\n</section>\n',e}),define("views/admin/questions_form",["lib/maria","controllers/admin/questions_form","templates/admin/questions_form","route_helper"],function(e,t,n,r){var i={};return e.ElementView.subclass(i,"AdminQuestionsFormView",{controllerConstructor:t,template:n.source,constructor:function(){e.ElementView.apply(this,arguments),r.mixin(this)},uiActions:{"click input.create":"onSubmit"},properties:{_formId:null,setFormId:function(e){this._formId=e},reset:function(){this.find("input.name").value="",this.find("select.type").selectedIndex=0,this.find("input.prompt").value=""},getValues:function(){var e=this.find("select.type");return{name:this.find("input.name").value,type:e.options[e.selectedIndex].value,prompt:this.find("input.prompt").value,form_id:this._formId}}}}),i.AdminQuestionsFormView}),define("views/admin/questions",["lib/maria","templates/admin/questions","views/admin/questions_list","views/admin/questions_form","route_helper"],function(e,t,n,r,i){var s={};return e.ElementView.subclass(s,"AdminQuestionsView",{controllerConstructor:null,template:t.source,constructor:function(t){e.ElementView.apply(this,arguments),i.mixin(this),this._listView=new n(t),this.appendChild(this._listView),this._formView=new r(t),this.appendChild(this._formView)},properties:{_listView:null,_formView:null,setFormId:function(e){this._formView.setFormId(e)}}}),s.AdminQuestionsView}),define("templates/app",[],function(){var e={};return e.source='<section class="app">\n  <header>\n    <h1>Collect</h1>\n  </header>\n  <div class="loading" style="display: none;"></div>\n</section>\n',e}),define("views/app",["lib/maria","models/projects","models/project","models/form","models/question","views/projects","views/admin/projects","views/admin/project","views/admin/forms","views/admin/form","views/admin/questions","controllers/app","templates/app"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p={};return e.ElementView.subclass(p,"AppView",{template:h.source,controllerConstructor:c,uiActions:{"click section.app":"onNavigate"},properties:{_store:null,setStore:function(e){this._store=e},buildUIActions:function(){e.ElementView.prototype.buildUIActions.apply(this,arguments);var t=this.getController().getWindow();e.on(t,"popstate",this,"onPopState")},onPopState:function(e){this.getController().route()},urlFor:function(e){return this.getController().urlFor(e)},showProjects:function(){this._showProjects(!1)},showAdminProjects:function(){this._showProjects(!0)},showAdminProject:function(e){var t=this;this._store.find("projects",parseInt(e),n,{success:function(e){t._startTransition(),t.appendChild(new u(e));var n=e.getForms();t._store.findAll("forms",n,r,{filter:{project_id:e.getId()},success:function(){t._store.addSetModel("forms",n)}});var i=new a(n);i.setProjectId(e.getId()),t.appendChild(i),t._endTransition()}})},showAdminForm:function(e){var t=this;this._store.find("forms",parseInt(e),r,{success:function(e){t._startTransition(),t.appendChild(new f(e));var n=e.getQuestions();t._store.findAll("questions",n,i,{filter:{form_id:e.getId()},success:function(){t._store.addSetModel("questions",n)}});var r=new l(n);r.setFormId(e.getId()),t.appendChild(r),t._endTransition()}})},_startTransition:function(){this.find(".loading").style.display="block";for(var e=this.childNodes.length-1;e>=0;e--)this.removeChild(this.childNodes[e])},_endTransition:function(){this.find(".loading").style.display="none"},_showProjects:function(e){var r=new t,i=this;this._store.findAll("projects",r,n,{success:function(){i._store.addSetModel("projects",r)}});var u=e?o:s;this._startTransition(),this.appendChild(new u(r)),this._endTransition()}}}),p.AppView}),requirejs.config({paths:{lib:"../../lib"}}),require(["persistence/local","controllers/app","views/app"],function(e,t,n){var r=new t,i=window.location.href.replace(/#.+$/,"");r.setRootUrl(i);var s=new e,o=new n(null,r);o.setStore(s),document.body.appendChild(o.build()),r.route()}),define("bootstrap",function(){});